<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FB é•·æ–‡ç ´åœˆç”¢ç”Ÿå™¨ App</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; color: #333; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #2c3e50; }
        .api-box { background-color: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107; margin-bottom: 20px; }
        .section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        textarea, input[type="text"], input[type="password"], select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 15px;}
        button { background-color: #3498db; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 5px; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { background-color: #2980b9; }
        button:disabled { background-color: #95a5a6; cursor: not-allowed; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .feedback-box { background-color: #e8f6f3; padding: 15px; border-radius: 5px; border-left: 4px solid #1abc9c; min-height: 100px; white-space: pre-wrap;}
        .loading { display: none; color: #e67e22; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸš€ FB é•·æ–‡ç”Ÿæˆèˆ‡ç·¨ä¿® App</h1>

    <div class="api-box">
        <label for="apiKey"><strong>ğŸ”‘ è«‹è¼¸å…¥ä½ çš„ OpenAI API Key (sk-...)ï¼š</strong></label>
        <input type="password" id="apiKey" placeholder="è²¼ä¸Šä½ çš„ API Keyï¼Œé—œé–‰ç¶²é å¾Œæœƒè‡ªå‹•æ¸…é™¤">
    </div>

    <div class="section">
        <h2>0. æ‰¾å°‹ç†±é–€å½±ç‰‡éˆæ„Ÿ (æ–¹æ¡ˆ A)</h2>
        <div class="grid">
            <div>
                <label for="videoCategory">è«‹é¸æ“‡ä½ æƒ³å¯«çš„é¡Œæé¡åˆ¥ï¼š</label>
                <select id="videoCategory" onchange="toggleCustomInput()">
                    <option value="è‡ªæˆ‘å°è©± / äººéš›é—œä¿‚ / å€‹äººæˆé•·">ğŸŒ± å¿ƒéˆ (è‡ªæˆ‘å°è©± / äººéš›é—œä¿‚ / å€‹äººæˆé•·)</option>
                    <option value="ç¡çœ ç§‘å­¸ / é£²é£Ÿç¿’æ…£ / èº«é«”ä¿å¥">ğŸ å¥åº· (ç¡çœ ç§‘å­¸ / é£²é£Ÿç¿’æ…£ / èº«é«”ä¿å¥)</option>
                    <option value="AI è¶¨å‹¢ / è·å ´è®ŠåŒ– / ç¤¾æœƒç¾è±¡">ğŸ“° æ™‚äº‹ (AI è¶¨å‹¢ / è·å ´è®ŠåŒ– / ç¤¾æœƒç¾è±¡)</option>
                    <option value="ç†è²¡è§€å¿µ / è²¡å‹™è‡ªç”± / æ”¶å…¥æˆé•·">ğŸ’° é‡‘éŒ¢ (ç†è²¡è§€å¿µ / è²¡å‹™è‡ªç”± / æ”¶å…¥æˆé•·)</option>
                    <option value="custom">âœï¸ è‡ªè¨‚å…¶ä»–é—œéµå­—...</option>
                </select>
                
                <input type="text" id="customKeyword" placeholder="è«‹è¼¸å…¥ä½ æƒ³æ‰¾çš„é—œéµå­—..." style="display: none;">
                
                <button id="btnFindVideos" onclick="findVideos()">ğŸ” è«‹ AI æ¨è–¦å½±ç‰‡</button>
                <div id="loadingVideos" class="loading">â³ æ­£åœ¨å°‹æ‰¾é«˜æ½›åŠ›å½±ç‰‡ï¼Œè«‹ç¨å€™...</div>
            </div>
            <div>
                <textarea id="videoOutput" rows="7" placeholder="AI æ¨è–¦çš„å½±ç‰‡é€£çµèˆ‡å»ºè­°è§’åº¦æœƒé¡¯ç¤ºåœ¨é€™è£¡..."></textarea>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>1. ç”¢å‡ºåˆç¨¿ (è²¼ä¸Š NotebookLM å ±å‘Š)</h2>
        <textarea id="notebookInput" rows="5" placeholder="å» YouTube æ‰¾å½±ç‰‡ä¸Ÿçµ¦ NotebookLM å¾Œï¼ŒæŠŠå ±å‘Šè²¼åœ¨é€™è£¡..."></textarea>
        <button id="btnGenerate" onclick="generateArticle()">âœ¨ ä¸€éµç”Ÿæˆæ–‡ç« </button>
        <div id="loadingGenerate" class="loading">â³ AI æ­£åœ¨å¥®åŠ›å¯«ä½œä¸­...</div>
    </div>

    <div class="section">
        <h2>2. äººæ©Ÿå”ä½œç·¨ä¿®å€</h2>
        <div class="grid">
            <div>
                <h3>âœï¸ æ–‡ç« ç·¨è¼¯å€ (å¯ç›´æ¥ä¿®æ”¹)</h3>
                <textarea id="articleEditor" rows="18" placeholder="AI ç”Ÿæˆçš„æ–‡ç« æœƒé¡¯ç¤ºåœ¨é€™è£¡..."></textarea>
            </div>
            <div>
                <h3>ğŸ§  AI æ•™ç·´åˆ†æå ±å‘Š</h3>
                <div id="analysisOutput" class="feedback-box">åˆ†æçµæœæœƒé¡¯ç¤ºæ–¼æ­¤...</div>
                <input type="text" id="userFeedback" placeholder="è¼¸å…¥ä½ çš„ä¿®æ”¹è§€é» (ä¾‹å¦‚ï¼šèªæ°£å†å¹½é»˜ä¸€é»)">
                <button id="btnRefine" onclick="refineArticle()">ğŸ”„ åˆ†æä¸¦å±€éƒ¨æ”¹å¯«</button>
                <div id="loadingRefine" class="loading">â³ æ•™ç·´åˆ†æèˆ‡æ”¹å¯«ä¸­...</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>3. ç¸½ç·¨æœ€çµ‚å¯©ç¨¿</h2>
        <button id="btnFinal" onclick="finalAnalysis()">âœ… é€²è¡Œæœ€å¾Œæª¢æŸ¥</button>
        <div id="loadingFinal" class="loading">â³ ç¸½ç·¨æ­£åœ¨æª¢æŸ¥é‚è¼¯èˆ‡èªæ°£...</div>
        <div id="finalOutput" class="feedback-box" style="margin-top: 10px;">æœ€å¾Œæª¢æŸ¥çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...</div>
    </div>
</div>

<script>
    const SYSTEM_PROMPT = `
ä½ æ˜¯ä¸€ä½è³‡æ·±ç¤¾ç¾¤å¯«ä½œæ•™ç·´èˆ‡å°ˆæ¥­æ–‡æ¡ˆã€‚
ä»»å‹™ï¼šè«‹æŠŠä½¿ç”¨è€…æä¾›çš„æ–‡ç« ï¼Œæ”¹å¯«æˆä¸€ç¯‡è‡‰æ›¸è²¼æ–‡ï¼Œç›¡é‡ä¿ç•™åŸæ–‡è³‡è¨Šè±å¯Œåº¦èˆ‡ç´°ç¯€ï¼ŒåŒ…å«ç ”ç©¶å‡ºè™•ã€é—œéµæ•¸æ“šã€åäººæ¡ˆä¾‹ã€çœŸå¯¦å°ç™½ï¼Œä¸è¦éåº¦åˆªæ¸›ï¼Œä¹Ÿä¸è¦æ†‘ç©ºæé€ ï¼Œæ–‡ç« è‡³å°‘ 1200ï½1500 å­—ä»¥ä¸Šã€‚
é¢¨æ ¼ï¼šå£èªåŒ–ï¼Œç…½æƒ…ã€ä½†ä¸èªªæ•™ã€‚æƒ…ç·’è¡¨é”è±å¯Œï¼ˆé©šè¨ã€æ•¬ç•ã€æ‡¸å¿µã€ææ‡¼ã€ç„¦æ…®ã€æ†¤æ€’ã€å¥½ç¬‘ã€æ„Ÿå‹•ï¼‰ã€‚è³‡è¨Šå¯†åº¦é«˜ã€é•·çŸ­å¥äº¤éŒ¯ã€‚
æ³¨æ„ï¼šä¸è¦éåº¦æƒ³è¦èªªæœä»–äººã€ä¸è¦æŠŠè®€è€…ç•¶ç™½ç™¡ã€‚
ã€çµ•å°ç¦ç”¨ä»¥ä¸‹è©å½™èˆ‡å¥å‹ã€‘ï¼š
ã€Œä¸æ˜¯ï¼¯ï¼¯è€Œæ˜¯ï¼¯ï¼¯ã€å…¶å¯¦å¾ˆï¼¯ï¼¯ã€å¾ä¾†ä¸æ˜¯ã€æº«æŸ”æé†’ã€é€™ä¸æ˜¯å¶ç„¶ã€å¾ˆç©©ã€åœä½ã€æ’ä½ã€å†·æ‰ã€å®‰éœã€æ®˜é…·ã€å¾ˆç›´æ¥ã€èµ°å¾—å¾ˆæ·±ã€èƒŒè„Šç™¼æ¶¼ã€é™°é™½æ€ªæ°£ã€å…¶å¯¦å¾ˆå–®ç´”ã€å†æ™®é€šä¸éçš„ã€ç•™ä¸‹ä¸€å¥è©±ã€è€Œæ˜¯é¡˜æ„èªªä¸€å¥ã€å›é ­çœ‹ã€å¾ˆåƒã€å€¼å¾—æ·±æ€ã€ä»¤äººæ·±æ€ã€å¼•äººæ·±æ€ã€ä¸ç¦è®“äººã€ä¸å¾—ä¸èªªã€æ¯«ç„¡ç–‘å•ã€è®“æˆ‘å€‘ã€è©¦æƒ³ã€æƒ³åƒä¸€ä¸‹ã€
ã€æ ¼å¼æ›´æ­£èˆ‡æ¨™è¨»é™åˆ¶ã€‘ï¼š
1. å»é™¤åˆ†éš”ç·šã€è¡¨æƒ…ç¬¦è™Ÿèˆ‡ä¸»é¡Œæ¨™ç±¤åŠå…¶å…§å®¹ã€‚
2. å¦‚æœè³‡æ–™ä¾†æºæåˆ°åå­—æ™‚ï¼ŒåŒ…å«ä¸­è­¯åèˆ‡è‹±æ–‡åŸåï¼Œè«‹åœ¨ç¬¬ä¸€æ¬¡å‡ºç¾æ™‚ï¼Œåœ¨ä¸­è­¯åå¾ŒåŠ è¨»è‹±æ–‡åŸåã€‚
3. å…§æ–‡å¦‚æœéœ€è¦åˆ†æ®µæ¨™é¡Œï¼Œè«‹ç”¨ç¬¦åˆå…§å®¹çš„æ¨™é¡Œï¼Œåœ¨æ–‡å­—å‰ç½®å…¥ï¼šâ–‹
4. æ–‡ç« æ¨™é¡Œæ ¼å¼å¿…é ˆç‚ºï¼š
ã€ä¸»æ¨™ã€‘
â€”â€” å‰¯æ¨™
    `;

    async function callOpenAI(messages, temperature, loadingId, buttonId) {
        const apiKey = document.getElementById('apiKey').value.trim();
        if (!apiKey) {
            alert("è«‹å…ˆåœ¨æœ€ä¸Šæ–¹å¡«å¯«ä½ çš„ OpenAI API Keyï¼");
            return null;
        }

        document.getElementById(loadingId).style.display = 'block';
        document.getElementById(buttonId).disabled = true;

        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + apiKey
                },
                body: JSON.stringify({
                    model: 'gpt-4o',
                    messages: messages,
                    temperature: temperature
                })
            });
            
            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            return data.choices[0].message.content;

        } catch (error) {
            alert("ç™¼ç”ŸéŒ¯èª¤ï¼š" + error.message);
            console.error(error);
            return null;
        } finally {
            document.getElementById(loadingId).style.display = 'none';
            document.getElementById(buttonId).disabled = false;
        }
    }

    function toggleCustomInput() {
        const category = document.getElementById('videoCategory').value;
        const customInput = document.getElementById('customKeyword');
        if (category === 'custom') {
            customInput.style.display = 'block';
        } else {
            customInput.style.display = 'none';
        }
    }

    // æ­¥é©Ÿ 0ï¼šæ‰¾å½±ç‰‡åŠŸèƒ½
    async function findVideos() {
        let keyword = document.getElementById('videoCategory').value;
        if (keyword === 'custom') {
            keyword = document.getElementById('customKeyword').value.trim();
            if (!keyword) return alert("è«‹è¼¸å…¥è‡ªè¨‚é—œéµå­—ï¼");
        }

        const promptContext = `å¹«æˆ‘æ‰¾ 3 æ”¯é—œæ–¼ã€${keyword}ã€‘çš„ YouTube å½±ç‰‡ã€‚\næ¢ä»¶ï¼šç€è¦½è‡³å°‘ 10 è¬ã€ä¸€å¹´å…§ç™¼å¸ƒã€éä¸­æ–‡ã€çŸ¥è­˜å‹é »é“å„ªå…ˆã€‚\næ¯æ”¯è«‹çµ¦æˆ‘ï¼šæ¨™é¡Œï¼‹é€£çµï¼‹ä¸€å¥è©±èªªæ˜é©åˆæ”¹å¯«æˆä»€éº¼ä¸»é¡Œï¼‹å»ºè­°é–‹é ­è§’åº¦ã€‚`;

        const messages = [
            { role: "system", content: "ä½ æ˜¯ä¸€ä½å° YouTube è¶¨å‹¢æ•éŠ³çš„ç¤¾ç¾¤ä¼åŠƒã€‚è«‹ç²¾æº–æä¾›ç¬¦åˆæ¢ä»¶çš„ YouTube å½±ç‰‡ã€‚" },
            { role: "user", content: promptContext }
        ];
        
        document.getElementById('videoOutput').value = "AI æœå°‹ä¸­ï¼Œè«‹ç¨å€™...";
        const result = await callOpenAI(messages, 0.7, 'loadingVideos', 'btnFindVideos');
        if (result) document.getElementById('videoOutput').value = result;
    }

    // æ­¥é©Ÿ 1ï¼šç”Ÿæˆåˆç¨¿
    async function generateArticle() {
        const text = document.getElementById('notebookInput').value;
        if (!text) return alert("è«‹å…ˆè²¼ä¸Š NotebookLM å ±å‘Šï¼");
        const messages = [
            { role: "system", content: SYSTEM_PROMPT },
            { role: "user", content: "ä»¥ä¸‹æ˜¯ NotebookLM æ•´ç†çš„å ±å‘Šï¼Œè«‹æ ¹æ“šè¦å‰‡å¹«æˆ‘æ”¹å¯«ï¼š\n\n" + text }
        ];
        const result = await callOpenAI(messages, 0.7, 'loadingGenerate', 'btnGenerate');
        if (result) document.getElementById('articleEditor').value = result;
    }

    // æ­¥é©Ÿ 2ï¼šåˆ†æèˆ‡æ”¹å¯«
    async function refineArticle() {
        const article = document.getElementById('articleEditor').value;
        const feedback = document.getElementById('userFeedback').value;
        if (!article) return alert("è«‹å…ˆç”Ÿæˆæˆ–è²¼ä¸Šæ–‡ç« ï¼");
        
        document.getElementById('analysisOutput').innerText = "åˆ†æä¸­...";
        const analysisMessages = [
            { role: "system", content: "ä½ æ˜¯ä¸€ä½è³‡æ·±ç¤¾ç¾¤å¯«ä½œæ•™ç·´ï¼Œè«‹åˆ†æé€™ç¯‡æ–‡ç« çš„é¢¨æ ¼èˆ‡å„ªç¼ºé»ï¼Œä»¥åŠå¯å„ªåŒ–çš„åœ°æ–¹ã€‚" },
            { role: "user", content: "é€™æ˜¯ç›®å‰å¯«å¥½çš„æ–‡ç« ï¼š\n\n" + article + "\n\næˆ‘çš„é¡å¤–å„ªåŒ–è¦æ±‚/è§€é»ï¼š" + feedback }
        ];
        const analysisResult = await callOpenAI(analysisMessages, 0.7, 'loadingRefine', 'btnRefine');
        if (!analysisResult) return;
        document.getElementById('analysisOutput').innerText = analysisResult;

        const rewriteMessages = [
            { role: "system", content: SYSTEM_PROMPT },
            { role: "user", content: "é€™æ˜¯åŸæ–‡ç« ï¼š\n" + article + "\n\né€™æ˜¯æ•™ç·´çš„åˆ†æèˆ‡å„ªåŒ–å»ºè­°ï¼š\n" + analysisResult + "\n\nä»»å‹™ï¼šè«‹æŒ‰ç…§æ•™ç·´æä¾›çš„æ–¹å‘èª¿æ•´ã€‚åŸæ–‡ç›¡é‡ä¸æ”¹å‹•ï¼Œåªèª¿æ•´å¿…è¦èª¿æ•´çš„åœ°æ–¹ï¼Œä¸è¦å¾é ­åˆ°å°¾æ”¹å¯«ã€‚ä¸è¦èˆ‡æˆ‘äº’å‹•èˆ‡å°è©±ï¼Œç›´æ¥çµ¦æˆ‘ä¿®æ”¹å¾Œçš„æ–‡ç« ã€‚" }
        ];
        const newArticle = await callOpenAI(rewriteMessages, 0.5, 'loadingRefine', 'btnRefine');
        if (newArticle) document.getElementById('articleEditor').value = newArticle;
    }

    // æ­¥é©Ÿ 3ï¼šç¸½ç·¨æœ€å¾Œæª¢æŸ¥
    async function finalAnalysis() {
        const article = document.getElementById('articleEditor').value;
        if (!article) return alert("è«‹å…ˆç¢ºèªç·¨è¼¯å€æœ‰æ–‡ç« ï¼");

        const messages = [
            { role: "system", content: "ä½ æ˜¯ä¸€ä½åš´æ ¼ä¸”ç´°å¿ƒçš„ç¤¾ç¾¤å…§å®¹ç¸½ç·¨ã€‚è«‹é‡å°ä½¿ç”¨è€…æä¾›çš„æœ€çµ‚ç‰ˆè‡‰æ›¸é•·æ–‡ï¼Œé€²è¡Œæœ€å¾Œçš„æª¢æŸ¥ã€‚è«‹ç¢ºèªï¼š1. èªæ°£æ˜¯å¦è‡ªç„¶ä¸”æœ‰æº«åº¦ã€2. ç¯€å¥æ˜¯å¦é †æš¢ã€3. æœ‰æ²’æœ‰æ˜é¡¯çš„é‚è¼¯ç›²é»æˆ–éŒ¯åˆ¥å­—ã€‚è«‹ä»¥ç°¡çŸ­ã€æ¢åˆ—å¼çš„æ–¹å¼çµ¦å‡ºæœ€å¾Œçš„å›é¥‹èˆ‡æé†’å³å¯ï¼Œã€ä¸è¦ã€‘é‡æ–°æ”¹å¯«æ–‡ç« ã€‚" },
            { role: "user", content: "é€™æ˜¯æˆ‘äººå·¥ç²¾ä¿®å¾Œçš„æ–‡ç« ï¼Œè«‹å¹«æˆ‘åšæœ€å¾Œçš„åˆ†æç¢ºèªï¼š\n\n" + article }
        ];
        
        const result = await callOpenAI(messages, 0.3, 'loadingFinal', 'btnFinal');
        if (result) document.getElementById('finalOutput').innerText = result;
    }
</script>
</body>
</html>